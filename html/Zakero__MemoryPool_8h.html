<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Zakero&#39;s C++ Header Libraries: Zakero_MemoryPool.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Zakero&#39;s C++ Header Libraries
   </div>
   <div id="projectbrief">A collection of reusable C++ libraries</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a>  </div>
  <div class="headertitle">
<div class="title">Zakero_MemoryPool.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Zakero MemoryPool.  
<a href="#details">More...</a></p>
<div class="textblock"><div class="dynheader">
Include dependency graph for Zakero_MemoryPool.h:</div>
<div class="dyncontent">
<div class="center"><img src="Zakero__MemoryPool_8h__incl.png" border="0" usemap="#Zakero__MemoryPool_8h" alt=""/></div>
<map name="Zakero__MemoryPool_8h" id="Zakero__MemoryPool_8h">
<area shape="rect" title="Zakero MemoryPool." alt="" coords="218,5,371,32"/>
<area shape="rect" title=" " alt="" coords="5,80,67,107"/>
<area shape="rect" title=" " alt="" coords="91,80,170,107"/>
<area shape="rect" title=" " alt="" coords="194,80,241,107"/>
<area shape="rect" title=" " alt="" coords="265,80,324,107"/>
<area shape="rect" title=" " alt="" coords="349,80,443,107"/>
<area shape="rect" title=" " alt="" coords="468,80,567,107"/>
<area shape="rect" title=" " alt="" coords="591,80,659,107"/>
</map>
</div>
</div>
<p><a href="Zakero__MemoryPool_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classzakero_1_1MemoryPool.html">zakero::MemoryPool</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A pool of memory.  <a href="classzakero_1_1MemoryPool.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ad5cdfd37be94b166464e8be23e33d76b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Zakero__MemoryPool_8h.html#ad5cdfd37be94b166464e8be23e33d76b">ZAKERO_MEMORYPOOL_IMPLEMENTATION</a></td></tr>
<tr class="memdesc:ad5cdfd37be94b166464e8be23e33d76b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Activate the implementation code.  <a href="Zakero__MemoryPool_8h.html#ad5cdfd37be94b166464e8be23e33d76b">More...</a><br /></td></tr>
<tr class="separator:ad5cdfd37be94b166464e8be23e33d76b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79d46683e1bf6ca78be62092971c3c14"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Zakero__MemoryPool_8h.html#a79d46683e1bf6ca78be62092971c3c14">ZAKERO_MEMORYPOOL_PROFILER</a></td></tr>
<tr class="memdesc:a79d46683e1bf6ca78be62092971c3c14"><td class="mdescLeft">&#160;</td><td class="mdescRight">Activate the profiling code.  <a href="Zakero__MemoryPool_8h.html#a79d46683e1bf6ca78be62092971c3c14">More...</a><br /></td></tr>
<tr class="separator:a79d46683e1bf6ca78be62092971c3c14"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1e4950608562ce3aad4d64cb9aebbb0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Zakero__MemoryPool_8h.html#ac1e4950608562ce3aad4d64cb9aebbb0">ZAKERO_MEMORYPOOL_PROFILER_FILE</a></td></tr>
<tr class="memdesc:ac1e4950608562ce3aad4d64cb9aebbb0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Profile data file.  <a href="Zakero__MemoryPool_8h.html#ac1e4950608562ce3aad4d64cb9aebbb0">More...</a><br /></td></tr>
<tr class="separator:ac1e4950608562ce3aad4d64cb9aebbb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1e4950608562ce3aad4d64cb9aebbb0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Zakero__MemoryPool_8h.html#ac1e4950608562ce3aad4d64cb9aebbb0">ZAKERO_MEMORYPOOL_PROFILER_FILE</a></td></tr>
<tr class="memdesc:ac1e4950608562ce3aad4d64cb9aebbb0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Profile data file.  <a href="Zakero__MemoryPool_8h.html#ac1e4950608562ce3aad4d64cb9aebbb0">More...</a><br /></td></tr>
<tr class="separator:ac1e4950608562ce3aad4d64cb9aebbb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Here, you will find information about and how to add the <em>Zakero MemoryPool</em> to your project.</p>
<p>See <a class="el" href="classzakero_1_1MemoryPool.html" title="A pool of memory.">zakero::MemoryPool</a> for the class API documentation.</p>
<p>\dependencies</p><ul>
<li><a class="el" href="Zakero__Base_8h.html" title="Zakero Base.">Zakero_Base.h</a><br  />
</li>
<li><a class="el" href="Zakero__Profiler_8h.html" title="Zakero Profiler.">Zakero_Profiler.h</a><br  />
 Defining <a class="el" href="Zakero__MemoryPool_8h.html#a79d46683e1bf6ca78be62092971c3c14">ZAKERO_MEMORYPOOL_PROFILER</a> will cause the Zakero_Profiler to be included. If <a class="el" href="Zakero__MemoryPool_8h.html#a79d46683e1bf6ca78be62092971c3c14">ZAKERO_MEMORYPOOL_PROFILER</a> is <b>not</b> defined, then the <a class="el" href="Zakero__Profiler_8h.html" title="Zakero Profiler.">Zakero_Profiler.h</a> is no longer a dependency.</li>
</ul>
<p>\tldr This library will provide a memory pool for your application. To use:</p><ol type="1">
<li>Add the implementation to a source code file: <div class="fragment"><div class="line"><span class="preprocessor">#define ZAKERO_MEMORYPOOL_IMPLEMENTATION</span></div>
<div class="line"><span class="preprocessor">#include &quot;path/to/Zakero_MemoryPool.h&quot;</span></div>
</div><!-- fragment --></li>
<li>Add the library to where it is used: <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;path/to/Zakero_MemoryPool.h&quot;</span></div>
</div><!-- fragment --></li>
</ol>
<dl class="section user"><dt>What Is It?</dt><dd><p class="startdd">The <em>Zakero MemoryPool</em> library will create and manage a region of memory. From this pool of memory, sections of memory can be allocated and freed. When allocated, the memory is identified by an offset into the region of memory instead of a pointer. Programs are expected to be "good citizens" by using the offset and not writing outside of their allocated area.</p>
<p class="enddd">The region of memory is anchored to an anonymous file descriptor. The benefit of using the file description is that the Operating System can remap the file to a larger area as needed. And since all allocated memory uses an offset, no pointers end up pointing to a bad location. </p>
</dd></dl>
<dl class="section user"><dt>Why Use It?</dt><dd><p class="startdd">As with many things, there are benefits and draw backs to using a memory pool. For the MemoryPool object they are:</p>
<p class="interdd"><b>Benefits</b></p><ul>
<li>SPEED!!! Much faster allocations than <code>new</code> or <code>malloc</code></li>
<li>Data focused, allocations are based on size not object-type</li>
<li>The entire memory pool can be easily shared across process-space</li>
<li>Can automatically grow as needed [optional feature]</li>
</ul>
<p class="interdd"><b>Draw Backs</b></p><ul>
<li>Requires extra work to convert offsets to pointers</li>
<li>If the memory pool expands, pointers can be invalidated</li>
<li>Memory fragmentation has more of an impact</li>
<li>No bounds checking in memory writes</li>
</ul>
<p class="interdd">To put things into perspective, allocating memory is a very expensive operation. Using the MemoryPool means this operation only needs to happen once. Allocating memory from the MemoryPool just needs to scan the memory region that can hold the request size. Even for extremely large memory pools, this is a very fast operation. Requiring the size (in bytes) to be allocated from the MemoryPool contributes to the speed of the allocation.</p>
<p class="interdd">Since the MemoryPool uses a Unix File Descriptor for the memory region, only that Unix File Descriptor must be shared between processes to access the entire MemoryPool data.</p>
<p class="interdd">As a result of using a Unix File Descriptor, allocating memory returns an offset into the MemoryPool data. When the memory region expands in the MemoryPool, the location of the "file" may change. Using offsets into the data negates the problem of pointing to invalid memory. Unfortunately, programming uses pointers instead of offsets. MemoryPool does provide a way to be notified when the memory region moves so the pointers an application is using can be updated.</p>
<p class="interdd">Unless C++'s <a href="https://en.cppreference.com/w/cpp/language/new#Placement_new">Placement New</a> is being used extensively, the developer must be fully aware of where they are in their area of the memory region so that other data is not over written. <br  />
 <em>Placement New will break when the memory region moves.</em></p>
<p class="interdd">Memory fragmentation already happens in most applications. The impact of the fragmentation is not felt due to huge amounts of memory in today's computers. However, for small amounts of memory fragmentation becomes a larger issue. Over the course of an application's life-time, it may allocate and free memory many times. At some point in time, if a large block of memory is requested, that allocation may fail because a contiguous region of memory is not available. This is the problem that plagues memory pools.</p>
<p class="interdd">If the benefits out-weigh the draw backs for your application, then the MemoryPool is what you need.</p>
<p class="enddd"></p>
</dd></dl>
<dl class="section note"><dt>Note</dt><dd>This implementation is limited to signed 32-bit file sizes. </dd></dl>
<dl class="section user"><dt>How To Use It?</dt><dd><p class="startdd"><b>Step 0</b></p>
<p class="interdd">Your compiler must support at least the C++20 standard.</p>
<p class="interdd"><b>Step 1</b></p>
<p class="interdd">The first step is to select which C++ source code file will contain the <em>Zakero MemoryPool</em> implementation. Once the location has been determined, add the following to that file:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define ZAKERO_MEMORYPOOL_IMPLEMENTATION</span></div>
<div class="line"><span class="preprocessor">#include &quot;path/to/Zakero_MemoryPool.h&quot;</span></div>
</div><!-- fragment --><p class="interdd">The macro <a class="el" href="Zakero__MemoryPool_8h.html#ad5cdfd37be94b166464e8be23e33d76b">ZAKERO_MEMORYPOOL_IMPLEMENTATION</a> tells the header file to include the implementation of the MemoryPool.</p>
<p class="interdd">In all other files that will use the MemoryPool, they need to include the header.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;path/to/Zakero_MemoryPool.h&quot;</span></div>
</div><!-- fragment --><p class="interdd"><b>Step 2</b></p>
<p class="interdd">After creating a <a class="el" href="classzakero_1_1MemoryPool.html#aebc36a9036be655d221b7f34ea146b47">MemoryPool</a>, it must be <a class="el" href="classzakero_1_1MemoryPool.html#aae29b70a7a6baefdbd17351ebb977cbc">initialized</a> before it can be used. <br  />
 Once that is done, you can freely <a class="el" href="classzakero_1_1MemoryPool.html#abdcd6b5b42dffdd4630556fd80239ae8">allocate</a> and <a class="el" href="classzakero_1_1MemoryPool.html#a2d20c34a90c6dc856fa3bbe0c53c0930">free</a> memory from the MemoryPool.</p>
<p class="interdd">This is an example of creating two std::array's that are backed by the MemoryPool.</p>
<div class="fragment"><div class="line"><a class="code" href="classzakero_1_1MemoryPool.html">zakero::MemoryPool</a> memory_pool(<span class="stringliteral">&quot;Array_Data&quot;</span>);</div>
<div class="line"> </div>
<div class="line">constexpr <span class="keywordtype">size_t</span> count = 100;</div>
<div class="line"><span class="keywordtype">size_t</span> array_size = <span class="keyword">sizeof</span>(int64_t) * count;</div>
<div class="line"> </div>
<div class="line">memory_pool.init(array_size * 2);</div>
<div class="line"> </div>
<div class="line">off_t    offset = memory_pool.alloc(array_size);</div>
<div class="line">int64_t* ptr    = memory_pool.addressOf(offset);</div>
<div class="line"> </div>
<div class="line">std::array&lt;int64_t,count&gt;* array_1 = <span class="keyword">new</span>(ptr) std::array&lt;int64_t,count&gt;();</div>
<div class="line"> </div>
<div class="line">offset = memory_pool.alloc(array_size);</div>
<div class="line">ptr    = memory_pool.addressOf(offset);</div>
<div class="line"> </div>
<div class="line">std::array&lt;int64_t,count&gt;* array_2 = <span class="keyword">new</span>(ptr) std::array&lt;int64_t,count&gt;();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Do stuff with array_1 and array_2</span></div>
</div><!-- fragment --><p class="enddd"></p>
</dd></dl>
<dl class="section version"><dt>Version</dt><dd>0.9.0<ul>
<li>Updated to use <a class="el" href="Zakero__Base_8h.html" title="Zakero Base.">Zakero_Base.h</a></li>
</ul>
</dd>
<dd>
0.8.1<ul>
<li>Bug fixes</li>
<li>API changes</li>
</ul>
</dd>
<dd>
0.8.0<ul>
<li>Allocate and manage memory pool</li>
<li>Automatically expand the memory pool as needed</li>
<li>Share the region of memory using the file descriptor</li>
</ul>
</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd><a href="https://www.mozilla.org/en-US/MPL/2.0/">Mozilla Public License v2</a></dd></dl>
<dl class="section author"><dt>Author</dt><dd>Andrew "Zakero" Moore<ul>
<li>Original Author</li>
</ul>
</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd><p class="startdd">Add support for huge file sizes (64-bit / huge table fs)</p><ul>
<li>Maybe toggled via a macro flag </li>
</ul>
<p class="interdd">Be able to defrag the memory pool </p>
<p class="interdd">Pass a lambda to the resize() method so that how the memory is moved can be controlled. For example, if the memory was holding a texture, the texture should be "clipped" or "zero'ed" space added around the existing data. </p>
<p class="enddd">Be able to initialize a MemoryPool with a Unix File Descriptor and the file size. </p>
</dd></dl>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ad5cdfd37be94b166464e8be23e33d76b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5cdfd37be94b166464e8be23e33d76b">&#9670;&nbsp;</a></span>ZAKERO_MEMORYPOOL_IMPLEMENTATION</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ZAKERO_MEMORYPOOL_IMPLEMENTATION</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Defining this macro will cause the <a class="el" href="classzakero_1_1MemoryPool.html" title="A pool of memory.">zakero::MemoryPool</a> implementation to be included. This should only be done once, since compiler and/or linker errors will typically be generated if more than a single implementation is found.</p>
<dl class="section note"><dt>Note</dt><dd>It does not matter if the macro is given a value or not, only its existence is checked. </dd></dl>

</div>
</div>
<a id="a79d46683e1bf6ca78be62092971c3c14"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79d46683e1bf6ca78be62092971c3c14">&#9670;&nbsp;</a></span>ZAKERO_MEMORYPOOL_PROFILER</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ZAKERO_MEMORYPOOL_PROFILER</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Defining this macro will cause the <a class="el" href="classzakero_1_1MemoryPool.html" title="A pool of memory.">zakero::MemoryPool</a> implementation to also include profiling data.</p>
<p>Be careful using this feature. The <em>Zakero MemoryPool</em> will create a new instance of the <em>Zakero Profiler</em>. If a <a class="el" href="classzakero_1_1MemoryPool.html" title="A pool of memory.">zakero::MemoryPool</a> is created <b>before</b> the intended <em>Zakero Profiler</em>, the profiler in <a class="el" href="classzakero_1_1MemoryPool.html" title="A pool of memory.">zakero::MemoryPool</a> will take precedence.</p>
<dl class="section note"><dt>Note</dt><dd>It does not matter if the macro is given a value or not, only its existence is checked.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="Zakero__MemoryPool_8h.html#ac1e4950608562ce3aad4d64cb9aebbb0" title="Profile data file.">ZAKERO_MEMORYPOOL_PROFILER_FILE</a> </dd></dl>

</div>
</div>
<a id="ac1e4950608562ce3aad4d64cb9aebbb0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1e4950608562ce3aad4d64cb9aebbb0">&#9670;&nbsp;</a></span>ZAKERO_MEMORYPOOL_PROFILER_FILE <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ZAKERO_MEMORYPOOL_PROFILER_FILE</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Define this macro and set it to the file name than will contain the profiling data. If the <em>Zakero MemoryPool</em> has already setup else where, then this macro will be ignored.</p>
<p>The default value is "./zakero_MemoryPool_profile.json".</p>
<dl class="section note"><dt>Note</dt><dd><a class="el" href="Zakero__MemoryPool_8h.html#a79d46683e1bf6ca78be62092971c3c14">ZAKERO_MEMORYPOOL_PROFILER</a> must be defined for this macro to have any effect. </dd></dl>

</div>
</div>
<a id="ac1e4950608562ce3aad4d64cb9aebbb0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1e4950608562ce3aad4d64cb9aebbb0">&#9670;&nbsp;</a></span>ZAKERO_MEMORYPOOL_PROFILER_FILE <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ZAKERO_MEMORYPOOL_PROFILER_FILE</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Define this macro and set it to the file name than will contain the profiling data. If the <em>Zakero MemoryPool</em> has already setup else where, then this macro will be ignored.</p>
<p>The default value is "./zakero_MemoryPool_profile.json".</p>
<dl class="section note"><dt>Note</dt><dd><a class="el" href="Zakero__MemoryPool_8h.html#a79d46683e1bf6ca78be62092971c3c14">ZAKERO_MEMORYPOOL_PROFILER</a> must be defined for this macro to have any effect. </dd></dl>

</div>
</div>
</div><!-- contents -->
<div class="ttc" id="aclasszakero_1_1MemoryPool_html"><div class="ttname"><a href="classzakero_1_1MemoryPool.html">zakero::MemoryPool</a></div><div class="ttdoc">A pool of memory.</div><div class="ttdef"><b>Definition:</b> Zakero_MemoryPool.h:246</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>
